<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styleCadastro.css" />
    <title>Cadastro de Produtos</title>
  </head>

  <body>
    <div class="barra-horizontal">
          <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid d-flex justify-content-between align-items-center">
              <a class="navbar-brand" href="home.html">Home</a>
              <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle mt-1"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Menu
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="buscar_clientes.html">Clientes</a></li>
                      <li><a class="dropdown-item active" href="buscar_produtos.html">Produtos</a></li>
                      <li><a class="dropdown-item" href="buscar_serviços.html">Serviços</a></li>
                      <li><a class="dropdown-item " href="buscar_vendas.html">Vendas</a></li>
                      <li><a class="dropdown-item " href="relatorios.html">Relatórios</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
              <img class="img-logo" src="./resources/ImagemLogoEmpresaParaEstagio.png" alt="logo da empresa">
            </div>
          </nav>

      <div class="container">
        <main class="main">
          
          <div class="form-box">
            <form id="formulario-produto">
              <h4 class="mb-3 text-center card-cadastro">Cadastro de Produto</h4>
              
              
              <div id="campos-comuns" >
                <div class="mb-3">
                <label for="input-nome" class="form-label">Nome: <span style="color: red;">*</span></label>
                <input type="text" class="form-control" id="input-nome" required />
                </div>

                <div class="mb-3">
                <label for="input-codigoDeBarra" class="form-label">Codigo de Barra: <span style="color: red;">*</span></label>
                <input type="text" class="form-control" id="input-codigoDeBarra" required />
                </div>
                <div class="mb-3">
                <label for="descricao" class="form-label">Descrição: <span style="color: red;">*</span></label>
                <input type="text" class="form-control" id="input-descricao"  />
                </div>
                <div class="mb-3">
                <label for="input-estoque" class="form-label">Quantidade em Estoque: <span style="color: red;">*</span></label>
                <input type="number" min="0" class="form-control" id="input-estoque" required />
                </div>
                <div class="mb-3">
                <label for="input-preco" class="form-label">Preço Unitario: <span style="color: red;">*</span></label>
                <input type="number" step="0.01" min="0.01" class="form-control" id="input-preco" required />
                </div>
            
              
                <button type="submit" class="btn btn-primary botao-cadastrar">
                Cadastrar Produto
                </button>
              </div>
              
            </form>
          </div>

          <div class="div-aviso">
          </div>
        </main>
      </div>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    
    <script>
      const divAviso=document.getElementsByClassName("div-aviso")[0];
      const formularioProduto=document.getElementById("formulario-produto");
      const inputNome=document.getElementById("input-nome");
      const inputCodigoDeBarra=document.getElementById("input-codigoDeBarra");
      const inputDescricao=document.getElementById("input-descricao");
      const inputQuantidadeEmEstoque=document.getElementById("input-estoque");
      const inputPreco=document.getElementById("input-preco");
    

      
      
      formularioProduto.addEventListener("submit",(e)=>{   
        e.preventDefault();
        
          enviarDadosParaCriarProdutoNaApi(inputNome.value, inputCodigoDeBarra.value, inputDescricao.value, inputQuantidadeEmEstoque.value, inputPreco.value);
        });
        
      
      function enviarDadosParaCriarProdutoNaApi(nomeProduto, codigoDeBarra, descricao, quantidadeEmEstoque, precoUnitario) {
        let dados = {
            nomeProduto:nomeProduto,
            codigoDeBarra:codigoDeBarra,
            descricao:descricao,
            quantidadeEmEstoque:quantidadeEmEstoque,
            precoUnitario:precoUnitario,
        };

      fetch("https://localhost:7036/api/produto", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dados)
      })
        .then(async response => {
          
          if (!response.ok){
            const mensagemDeErro=await response.text();
            throw new Error(mensagemDeErro)
          } 
          mostrarAviso("Produto Cadastrado", "sucesso");
          setTimeout(()=>{
              window.location.href="./buscar_produtos.html"
            },1500)
        })
        .catch((e) =>{
          mostrarAviso(e, "erro");
        } )
    }

    function mostrarAviso(mensagem, tipo) {
      divAviso.textContent = mensagem;
      divAviso.classList.add("div-aviso-subir", tipo);
      setTimeout(() => {
        divAviso.classList.remove("div-aviso-subir");
        setTimeout(() => {
          divAviso.textContent = "";
          divAviso.classList.remove(tipo);
        }, 2000);
      }, 2000);
    }
     
    </script>
  </body>
</html>