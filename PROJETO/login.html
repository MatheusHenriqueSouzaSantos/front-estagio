<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styleLogin.css" />
  </head>

  <body>
    
    <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm">
      <div class="container-fluid d-flex justify-content-between align-items-center">
        <a class="navbar-brand" href="#">Bicicletaria</a>
        <img class="img-logo" src="./resources/ImagemLogoEmpresaParaEstagio.png" alt="logo da empresa">
      </div>
    </nav>

    
    <main class="main">
      <div class="form-box">
        <form id="form-login">
          <h4 class="mb-4 text-center card-login">Login</h4>

          <div class="mb-3">
            <label for="input-email" class="form-label">E-mail:</label>
            <input
              type="email"
              class="form-control"
              id="input-email"
              placeholder="exemplo@email.com"
              required
            />
          </div>

          <div class="mb-3">
            <label for="input-senha" class="form-label">Senha:</label>
            <input
              type="password"
              class="form-control"
              id="input-senha"
              placeholder="Digite sua senha"
              required
            />
          </div>

          <button type="submit" class="btn btn-primary w-100">Entrar</button>

         
        </form>
      </div>

      <div class="div-aviso"></div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const API_URL = "https://localhost:7036/api/usuario"; 
      const divAviso = document.querySelector(".div-aviso");
      const form = document.getElementById("form-login");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("input-email").value.trim();
        const senha = document.getElementById("input-senha").value.trim();

        if (!email || !senha) {
          mostrarAviso("Preencha todos os campos!", "erro");
          return;
        }

        const dadosLogin = {
          Email: email,
          Senha: senha
        };

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dadosLogin)
          });

          if (!response.ok) {
            const erroTexto = await response.text();
            throw new Error(`Erro ${response.status}: ${erroTexto}`);
          }

          const usuario = await response.json();

          localStorage.setItem("usuarioLogado", JSON.stringify(usuario));

          mostrarAviso("Login realizado com sucesso!", "sucesso");
          setTimeout(() => (window.location.href = "home.html"), 1500);
        } catch (erro) {
          console.error("Erro no login:", erro);
          mostrarAviso("E-mail ou senha incorretos!", "erro");
        }
      });

      function mostrarAviso(mensagem, tipo) {
        divAviso.textContent = mensagem;
        divAviso.classList.add("div-aviso-subir", tipo);
        setTimeout(() => {
          divAviso.classList.remove("div-aviso-subir");
          setTimeout(() => {
            divAviso.textContent = "";
            divAviso.classList.remove(tipo);
          }, 2000);
        }, 2000);
      }
    </script>
  </body>
</html>
