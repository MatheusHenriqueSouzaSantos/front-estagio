<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/styleCadastro.css" />
    <title>Cadastro de Serviço</title>
  </head>

  <body>
    <div class="barra-horizontal">
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid d-flex justify-content-between align-items-center">
          <a class="navbar-brand" href="home.html">Home</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle mt-1" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Menu</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="buscar_clientes.html">Clientes</a></li>
                  <li><a class="dropdown-item" href="buscar_produtos.html">Produtos</a></li>
                  <li><a class="dropdown-item active" href="buscar_serviços.html">Serviços</a></li>
                  <li><a class="dropdown-item " href="buscar_vendas.html">Vendas</a></li>
                  <li><a class="dropdown-item " href="relatorios.html">Relatórios</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <img class="img-logo" src="./resources/ImagemLogoEmpresaParaEstagio.png" alt="logo da empresa">
        </div>
      </nav>

      <div class="container">
        <main class="main">
          <div class="form-box">
            <form id="formulario-servico">
              <h4 class="mb-3 text-center card-cadastro">Cadastro de Serviço</h4>

              <div id="campos-comuns">
                <div class="mb-3">
                  <label for="input-nomeServico" class="form-label">Nome do Serviço: <span style="color: red;">*</span></label>
                  <input type="text" class="form-control" id="input-nomeServico" required />
                </div>

                <div class="mb-3">
                  <label for="input-codigoServico" class="form-label">Código do Serviço: <span style="color: red;">*</span></label>
                  <input type="text" class="form-control" id="input-codigoServico" required />
                </div>

                <div class="mb-3">
                  <label for="input-descricao" class="form-label">Descrição:</label>
                  <input type="text" class="form-control" id="input-descricao" />
                </div>

                <div class="mb-3">
                  <label for="input-precoServico" class="form-label">Preço (R$): <span style="color: red;">*</span></label>
                  <input type="number" step="0.01" min="0" class="form-control" id="input-precoServico" required />
                </div>

                <button type="submit" class="btn btn-primary botao-cadastrar">Cadastrar Serviço</button>
              </div>
            </form>
          </div>

          <div class="div-aviso"></div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const divAviso = document.getElementsByClassName("div-aviso")[0];
      const formularioServico = document.getElementById("formulario-servico");
      const inputNomeServico = document.getElementById("input-nomeServico");
      const inputCodigoServico = document.getElementById("input-codigoServico");
      const inputDescricao = document.getElementById("input-descricao");
      const inputPrecoServico = document.getElementById("input-precoServico");

      formularioServico.addEventListener("submit", (e) => {
        e.preventDefault();
        enviarDadosParaCriarServicoNaApi(
          inputNomeServico.value,
          inputCodigoServico.value,
          inputDescricao.value,
          inputPrecoServico.value
        );
      });

      function enviarDadosParaCriarServicoNaApi(nomeServico, codigoServico, descricao, precoServico) {
        let dados = {
          NomeServico: nomeServico,
          CodigoDoServico: codigoServico,
          Descricao: descricao,
          PrecoServico: parseFloat(precoServico)
        };

        fetch("https://localhost:7036/api/servico", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados)
        })
          .then((response) => {
            if (!response.ok) throw new Error("Erro no envio");
            mostrarAviso("Serviço cadastrado com sucesso!", "sucesso");
            setTimeout(()=>{
          window.location.href="./buscar_serviços.html"
        },1500)
          })
          .catch(() => mostrarAviso("Erro no envio de dados", "erro"));
      }

      function mostrarAviso(mensagem, tipo) {
        divAviso.textContent = mensagem;
        divAviso.classList.add("div-aviso-subir", tipo);
        setTimeout(() => {
          divAviso.classList.remove("div-aviso-subir");
          setTimeout(() => {
            divAviso.textContent = "";
            divAviso.classList.remove(tipo);
          }, 2000);
        }, 2000);
      }
    </script>
  </body>
</html>
