<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="css/relatorios.css" />
</head>
<body>
    <div class="barra-horizontal">
          <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid d-flex justify-content-between align-items-center">
              <a class="navbar-brand" href="home.html">Home</a>
              <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle mt-1"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Menu
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="buscar_clientes.html">Clientes</a></li>
                      <li><a class="dropdown-item" href="buscar_produtos.html">Produtos</a></li>
                      <li><a class="dropdown-item" href="buscar_serviços.html">Serviços</a></li>
                      <li><a class="dropdown-item" href="buscar_vendas.html">Vendas</a></li>
                      <li><a class="dropdown-item active" href="relatorios.html">Relatórios</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
              <img class="img-logo" src="./resources/ImagemLogoEmpresaParaEstagio.png" alt="logo da empresa">
            </div>
          </nav>
    </div>
    <main class="d-flex flex-wrap justify-content-center gap-3">
       <button id="botao-mostar-div-produtos-com-maior-faturamento-por-periodo" onclick="mostrarDivParaReceberDataParaRelatorio('div-gerar-relatorio-produtos-com-maior-faturamento-por-periodo')" class="botao-gerar-relatorio-produtos-mais-vendidos botoes-relatorio btn  shortcut-btn d-flex justify-content-center align-items-center">
        Relatório De Produtos Com Maior Faturamento Por Período
      </button>
      <button id="botao-mostar-div-produtos-em-falta" onclick="mostrarDivParaReceberQuantidadeProdutosEmFalta()" class="botao-gerar-relatorio-produtos-em-falta botoes-relatorio btn  shortcut-btn d-flex justify-content-center align-items-center">
        Relatório De Produtos Em Falta
      </button>
      <button id="botao-mostar-div-vendas-por-periodo" onclick="mostrarDivParaReceberDataParaRelatorio('div-gerar-relatorio-vendas-por-periodo')" class="botao-gerar-relatorio-de-vendas-por-periodo botoes-relatorio btn  shortcut-btn d-flex justify-content-center align-items-center">
        Relatório De Venda Por Período
      </button>
    </main>

    <div id="div-gerar-relatorio-produtos-com-maior-faturamento-por-periodo" class="div-relatorios">
      <h3 class="text-center mt-3 mb-3">Relatório De Produtos Com Maior Faturamento Por Período</h3>
        <i onclick="ocultarDivParaReceberDataPorPeriodo('div-gerar-relatorio-produtos-com-maior-faturamento-por-periodo','input-data-inicio-produtos-com-maior-faturamento','input-data-fim-produtos-com-maior-faturamento')" class="icone-arrow fa-solid fa-arrow-left" style="color: #000000;"></i>
        <label for="input-data-inicio-produtos-com-maior-faturamento">Data De Inicio Do Período</label>
        <input class="form-control" id="input-data-inicio-produtos-com-maior-faturamento" type="date" required>
        <label for="input-data-fim-produtos-com-maior-faturamento">Data De Fim Do Período</label>
        <input class="form-control" id="input-data-fim-produtos-com-maior-faturamento" type="date" required>
        <button onclick="gerarRelatorioDeProdutosComMaiorFaturamentoPorPeriodo()" id="botao-gerar-relatorio-produtos-com-maior-faturamento-por-periodo">Gerar Relatório</button>
    </div>
    <div id="div-gerar-relatorio-produtos-em-falta" class="div-relatorios">
      <h3 class="text-center mt-3 mb-3">Relatório De Produtos Em Falta:</h3>
        <i onclick="ocultarDivParaReceberQuantidadeProdutosEmFalta()" class="icone-arrow fa-solid fa-arrow-left" style="color: #000000;"></i>
        <label id="labe-quantidade-produtos-em-falta" for="input-quantidade-usada-para-busca-produtos-em-falta" >Digite a quantidade limite para buscar produtos com estoque menor ou igual ao valor informado:</label>
        <input class="form-control" id="input-quantidade-usada-para-busca-produtos-em-falta" type="number" required>
        <button onclick="gerarRelatorioDeProdutosEmFalta()" id="botao-gerar-relatorio-produtos-em-falta">Gerar Relatório</button>
    </div>
    <div id="div-gerar-relatorio-vendas-por-periodo" class="div-relatorios">
      <h3 class="text-center mt-3 mb-3">Relatório De Vendas Por Período</h3>
        <i onclick="ocultarDivParaReceberDataPorPeriodo('div-gerar-relatorio-vendas-por-periodo','input-data-inicio-venda-p-periodo','input-data-Fim-venda-p-periodo')" class="icone-arrow fa-solid fa-arrow-left" style="color: #000000;"></i>
        <label for="input-data-inicio-venda-p-periodo">Data De Inicio Do Período</label>
        <input class="form-control" id="input-data-inicio-venda-p-periodo" type="date" required>
        <label for="input-data-Fim-venda-p-periodo">Data De Fim Do Período</label>
        <input class="form-control" id="input-data-Fim-venda-p-periodo" type="date" required>
        <button onclick="gerarRelatorioDeVendasPorPeriodo()" id="botao-gerar-relatorio-vendas-por-periodo">Gerar Relatório</button>
    </div>

    <div class="div-aviso">
    </div>


    <script>
      const API_URL_PRODUTOS = "https://localhost:7036/api/produto/";
      const API_URL_VENDAS = "https://localhost:7036/api/venda/";
      const divAviso = document.getElementsByClassName("div-aviso")[0];
      const botaoMostrarDivProdutosComMaiorFaturamentoPorPeriodo=document.getElementById("botao-mostar-div-produtos-com-maior-faturamento-por-periodo");
      const botaoMostrarDivProdutosEmFalta=document.getElementById("botao-mostar-div-produtos-em-falta");
      const botaoMostrarDivVEndasPorPeriodo=document.getElementById("botao-mostar-div-vendas-por-periodo");
      let algumaDivEstaSendoMostrada=false;

      function mostrarDivParaReceberQuantidadeProdutosEmFalta(){
        if(algumaDivEstaSendoMostrada){
          return;
        }
        const divReceberQuantiadeProdutosEmFalta=document.getElementById("div-gerar-relatorio-produtos-em-falta")
        divReceberQuantiadeProdutosEmFalta.style.display="block";
        let inputQuantidade=document.getElementById("input-quantidade-usada-para-busca-produtos-em-falta").value=0
        algumaDivEstaSendoMostrada=true;
      }

      function ocultarDivParaReceberQuantidadeProdutosEmFalta(){
        const divReceberQuantiadeProdutosEmFalta=document.getElementById("div-gerar-relatorio-produtos-em-falta")
        divReceberQuantiadeProdutosEmFalta.style.display="none";
        const inputQuantidadeParaBuscaDeProdutosEmFalta=document.getElementById("input-quantidade-usada-para-busca-produtos-em-falta");
        let inputQuantidade=document.getElementById("input-quantidade-usada-para-busca-produtos-em-falta").value=0
        algumaDivEstaSendoMostrada=false
      }

      function mostrarDivParaReceberDataParaRelatorio(idDaDiv){
        if(algumaDivEstaSendoMostrada){
          return;
        }
        const div=document.getElementById(idDaDiv);
        div.style.display="block";
        algumaDivEstaSendoMostrada=true;
      }
      function ocultarDivParaReceberDataPorPeriodo(idDaDiv,idInputInicio,idInputFinal){
        const div=document.getElementById(idDaDiv);
        div.style.display="none";
        const inputDataInicio=document.getElementById(idInputInicio);
        inputDataInicio.value="";
        const inputDataFim=document.getElementById(idInputFinal);
        inputDataFim.value="";
        algumaDivEstaSendoMostrada=false
      }

      function gerarRelatorioDeVendasPorPeriodo(){
        let dataDeInicioVendaPorPeriodo=document.getElementById("input-data-inicio-venda-p-periodo").value;
        let dataDeFimVendaPorPeriodo=document.getElementById("input-data-Fim-venda-p-periodo").value;

        if(!dataDeInicioVendaPorPeriodo){
          mostrarAviso("Data de início precisa ser informada","erro")
          return
        }
        if(!dataDeFimVendaPorPeriodo){
          mostrarAviso("Data de Fim precisa ser informada","erro")
          return
        }

        const regexData = /^\d{4}-\d{2}-\d{2}$/;

        if(!regexData.test(dataDeInicioVendaPorPeriodo)){
          mostrarAviso("Data de início está em formato inválido.","erro")
          return;
        }

        if(!regexData.test(dataDeFimVendaPorPeriodo)){
          mostrarAviso("Data de Fim está em formato inválido.","erro")
          return;
        }
        if(dataDeInicioVendaPorPeriodo> dataDeFimVendaPorPeriodo){
          mostrarAviso("A Data de Início do período não pode ser maior do que a data de Fim do Período","erro")
          return;
        }

        let body={
          DataDeInicioDoPeriodo : dataDeInicioVendaPorPeriodo,
          DataDeFimDoPeriodo : dataDeFimVendaPorPeriodo
        }
        
        fetch(API_URL_VENDAS+"relatorio-de-vendas-por-periodo",{
          method : "POST",
          headers :{
            "Content-type" : "application/json"
          },
          body : JSON.stringify(body)
        })
         .then(response=>response.blob())
        .then(blob=>{
          const url=URL.createObjectURL(blob);
          window.open(url,"_blank")
        })
        .catch(erro=>mostrarAviso(erro,"erro"))
      }
      function gerarRelatorioDeProdutosComMaiorFaturamentoPorPeriodo(){
        let dataDeInicioProdutosComaMaiorFaturamentoPorPeriodoPeriodo=document.getElementById("input-data-inicio-produtos-com-maior-faturamento").value;
        let dataDeFimProdutosComaMaiorFaturamentoPorPeriodoPeriodo=document.getElementById("input-data-fim-produtos-com-maior-faturamento").value;

        if(!dataDeInicioProdutosComaMaiorFaturamentoPorPeriodoPeriodo){
          mostrarAviso("Data de início precisa ser informada","erro")
          return
        }
        if(!dataDeFimProdutosComaMaiorFaturamentoPorPeriodoPeriodo){
          mostrarAviso("Data de Fim precisa ser informada","erro")
          return
        }

        const regexData = /^\d{4}-\d{2}-\d{2}$/;

        if(!regexData.test(dataDeInicioProdutosComaMaiorFaturamentoPorPeriodoPeriodo)){
          mostrarAviso("Data de início está em formato inválido.","erro")
          return;
        }

        if(!regexData.test(dataDeFimProdutosComaMaiorFaturamentoPorPeriodoPeriodo)){
          mostrarAviso("Data de Fim está em formato inválido.","erro")
          return;
        }

        let body={
          DataDeInicioDoPeriodo : dataDeInicioProdutosComaMaiorFaturamentoPorPeriodoPeriodo,
          DataDeFimDoPeriodo : dataDeFimProdutosComaMaiorFaturamentoPorPeriodoPeriodo
        }
        
        fetch(API_URL_PRODUTOS+"relatorio-produtos-com-maior-faturamento-por-periodo",{
          method : "POST",
          headers :{
            "Content-type" : "application/json"
          },
          body : JSON.stringify(body)
        })
        .then(response=>response.blob())
        .then(blob=>{
          const url=URL.createObjectURL(blob);
          window.open(url,"_blank")
        })
        .catch(erro=>mostrarAviso(erro,"erro"))
      }

      function gerarRelatorioDeProdutosEmFalta(){
        const quantidadeUsadaParaBuscarProdutosEmFalta=document.getElementById("input-quantidade-usada-para-busca-produtos-em-falta").value;
        
        if(!quantidadeUsadaParaBuscarProdutosEmFalta){
          mostrarAviso("Quantidade Para Busca Precisa ser informada","erro")
          return
        }

        if(quantidadeUsadaParaBuscarProdutosEmFalta<0){
          mostrarAviso("A Qutidade usada para busca não pode ser menor que 0","erro")
          return;
        }
        if(quantidadeUsadaParaBuscarProdutosEmFalta>150){
          mostrarAviso("A Quantidade Usada para produtos em falta não pode ser maior que 150","erro")
          return
        }
        
        fetch(API_URL_PRODUTOS+"relatorio-de-produtos-em-falta/"+quantidadeUsadaParaBuscarProdutosEmFalta,{
          method : "GET",
          headers :{
            "Content-type" : "application/json"
          }
        })
        .then(response=>response.blob())
        .then(blob=>{
          const url=URL.createObjectURL(blob);
          window.open(url,"_blank")
        })
        .catch(erro=>mostrarAviso(erro,"erro"))
      }

        function mostrarAviso(mensagem, tipo) {
        divAviso.textContent = mensagem;
        divAviso.classList.add("div-aviso-subir", tipo);
        setTimeout(() => {
          divAviso.classList.remove("div-aviso-subir");
          setTimeout(() => {
            divAviso.textContent = "";
            divAviso.classList.remove(tipo);
          }, 5000);
        }, 2300);
      }
      
    </script>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <footer>
   <p>© 2025 BikeCiaSystem</p>
  </footer>
  
</body>
</html>